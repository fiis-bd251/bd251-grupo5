# 7.1. Creación de Tablas

 
```sql
-- Eliminar tablas primero (en orden inverso de dependencia)
DROP TABLE IF EXISTS Incidencia CASCADE;
DROP TABLE IF EXISTS Monitoreo_ruta CASCADE;
DROP TABLE IF EXISTS EventoEntrega CASCADE;
DROP TABLE IF EXISTS RecepcionOrdenes CASCADE;
DROP TABLE IF EXISTS Conductores CASCADE;
DROP TABLE IF EXISTS Vehiculo CASCADE;
DROP TABLE IF EXISTS Cliente CASCADE;
DROP TABLE IF EXISTS evidencia CASCADE;
DROP TABLE IF EXISTS reclamo CASCADE;

DROP TYPE IF EXISTS estado_reclamo_enum CASCADE;
DROP TYPE IF EXISTS tipo_reclamo_enum CASCADE;
DROP TYPE IF EXISTS tipo_evidencia_enum CASCADE;
DROP TYPE IF EXISTS tipo_archivo_enum CASCADE;DROP TABLE IF EXISTS usuario CASCADE;

-- Eliminar tipos si existen
DROP TYPE IF EXISTS estado_vehiculo CASCADE;
DROP TYPE IF EXISTS estado_conductor CASCADE;
DROP TYPE IF EXISTS tipo_vehiculo CASCADE;
DROP TYPE IF EXISTS tipo_licencia CASCADE;
DROP TYPE IF EXISTS genero CASCADE;
DROP TYPE IF EXISTS tipo_cliente CASCADE;
DROP TYPE IF EXISTS tipo_negocio CASCADE;
DROP TYPE IF EXISTS estado_ruta CASCADE;
DROP TYPE IF EXISTS tipo_incidencia CASCADE;
DROP TYPE IF EXISTS severidad_incidencia CASCADE;
DROP TYPE IF EXISTS estado_gps CASCADE;
DROP TYPE IF EXISTS estado_carga CASCADE;
DROP TYPE IF EXISTS canal_de_atencion CASCADE;
DROP TYPE IF EXISTS hub CASCADE;
DROP TYPE IF EXISTS tipo_producto CASCADE;
DROP TYPE IF EXISTS sku CASCADE;

-- Crear los tipos ENUM
CREATE TYPE estado_vehiculo AS ENUM ('activo', 'inactivo');
CREATE TYPE estado_conductor AS ENUM ('activo', 'inactivo');
CREATE TYPE tipo_vehiculo AS ENUM ('camion', 'camioneta', 'furgoneta');
CREATE TYPE tipo_licencia AS ENUM ('A', 'B', 'C');
CREATE TYPE genero AS ENUM ('M', 'F', 'O');
CREATE TYPE tipo_cliente AS ENUM ('empresa', 'persona_natural');
CREATE TYPE tipo_negocio AS ENUM ('restaurante', 'hotel', 'supermercado', 'distribuidor', 'otro');
CREATE TYPE estado_ruta AS ENUM ('activo', 'inactivo');
CREATE TYPE tipo_incidencia AS ENUM (
    'accidente', 
    'averia_vehiculo', 
    'desvio_ruta', 
    'problema_temperatura', 
    'retraso', 
    'clima_adverso',
    'problema_trafico',
    'apertura_no_autorizada',
    'otro'
);
CREATE TYPE severidad_incidencia AS ENUM ('baja', 'media', 'alta', 'critica');
CREATE TYPE estado_gps AS ENUM ('activo', 'inactivo', 'mantenimiento');
CREATE TYPE estado_carga AS ENUM ('completa', 'parcial', 'dañada');
CREATE TYPE canal_de_atencion AS ENUM ('autoservicio', 'foodservice', 'instituciones');
CREATE TYPE hub AS ENUM ('Esmeralda', 'Independencia', 'Huaral', 'Chincha');
CREATE TYPE tipo_producto AS ENUM ('pollo', 'pavo', 'embutido', 'cerdo', 'huevo');
CREATE TYPE sku AS ENUM ('trozos', 'filetes');

-- Crear tablas en orden de dependencia
CREATE TABLE usuario (
    cod_usuario UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    nombre_usuario VARCHAR(100) NOT NULL,
    contrasena VARCHAR(50) NOT NULL,
    rol VARCHAR(20) NOT NULL
);

--Creacion de types

CREATE TYPE estado_reclamo_enum AS ENUM (
    'solucionado', 
    'en pausa', 
    'en proceo',
    'rechazado'
);

CREATE TYPE tipo_reclamo_enum AS ENUM (
    'producto mal estado', 
    'producto equivocado', 
    'pedido incompleto',
    'no llegó el producto'  
);
CREATE TYPE tipo_evidencia_enum AS ENUM (
    'I',  -- Imagen
    'V',  -- Video
    'A',  -- Audio
    'D'   -- Documento
);

CREATE TYPE tipo_archivo_enum AS ENUM (
    'jpg',
    'png',
    'pdf',
    'mp4',
    'mp3'
);


-- Creación de las tablas
CREATE TABLE Cliente (
    id_cliente UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    tipo_cliente tipo_cliente NOT NULL,
    RUC VARCHAR(11) CHECK (RUC ~ '^[0-9]{11}$'),
    DNI CHAR(8) CHECK (DNI ~ '^[0-9]{8}$'),
    direccion VARCHAR(200) NOT NULL,
    distrito VARCHAR(50) NOT NULL,
    provincia VARCHAR(50) NOT NULL,
    departamento VARCHAR(50) NOT NULL,
    telefono VARCHAR(20) NOT NULL,
    telefono_alternativo VARCHAR(20),
    email VARCHAR(100),
    tipo_negocio tipo_negocio,
    horario_atencion VARCHAR(100),
    fecha_registro TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE Vehiculo (
    id_vehiculo UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    placa VARCHAR(20) NOT NULL UNIQUE CHECK (placa ~ '^[A-Z]{3}-[0-9]{3}$'),
    marca VARCHAR(50) NOT NULL,
    modelo VARCHAR(50) NOT NULL,
    año INTEGER NOT NULL CHECK (año BETWEEN 2000 AND EXTRACT(YEAR FROM CURRENT_DATE)),
    color VARCHAR(30) NOT NULL,
    tipo_vehiculo tipo_vehiculo NOT NULL,
    capacidad_carga DECIMAL(10,2) NOT NULL CHECK (capacidad_carga > 0),
    capacidad_combustible DECIMAL(10,2) NOT NULL CHECK (capacidad_combustible > 0),
    estado_vehiculo estado_vehiculo DEFAULT 'activo',
    numero_soat VARCHAR(20) NOT NULL UNIQUE CHECK (numero_soat ~ '^[A-Z]{3}-[0-9]{3}$'),
    fecha_vencimiento_soat DATE NOT NULL,
    fecha_registro TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    gps_imei VARCHAR(50) NOT NULL UNIQUE,
    gps_estado estado_gps NOT NULL DEFAULT 'activo',
    foto_vehiculo VARCHAR(255)
);

CREATE TABLE Conductor (
    id_conductor UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    DNI CHAR(8) NOT NULL UNIQUE CHECK (DNI ~ '^[0-9]{8}$'),
    nombre_conductor VARCHAR(100) NOT NULL,
    telefono_conductor VARCHAR(9) NOT NULL,
    email_conductor VARCHAR(100) NOT NULL,
    direccion_conductor TEXT,
    licencia_conductor VARCHAR(20) NOT NULL,
    estado_conductor estado_conductor DEFAULT 'activo',
    tipo_licencia tipo_licencia NOT NULL,
    fecha_emision_licencia DATE NOT NULL,
    fecha_vencimiento_licencia DATE NOT NULL,
    fecha_nacimiento DATE NOT NULL,
    fecha_registro TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    genero genero NOT NULL,
    foto_conductor VARCHAR(255)
);

CREATE TABLE Ruta (
    id_ruta UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    nombre_ruta VARCHAR(100) NOT NULL,
    distancia DECIMAL(10,2) NOT NULL CHECK (distancia > 0),
    origen VARCHAR(100) NOT NULL,
    destino VARCHAR(100) NOT NULL,
    coordenada_origen POINT NOT NULL,
    coordenada_destino POINT NOT NULL,
    fecha_creacion TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    fecha_actualizacion TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    estado_ruta estado_ruta DEFAULT 'activo',
    tiempo_estimado INTERVAL,
    ruta_planificada POINT[] NOT NULL
);

CREATE TABLE Carga (
    id_carga UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    fecha_carga DATE,
    hora_carga TIME,
    estado_carga estado_carga,
    sku sku,
    temperatura NUMERIC(4,2),
    canal_de_atencion canal_de_atencion,
    hub hub,
    tipo_producto tipo_producto
);

CREATE TABLE calidad_vehiculo (
    id_calidad UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    id_usuario UUID NOT NULL REFERENCES usuario(cod_usuario),
    fecha_verificacion DATE,
    hora_verificacion TIME,
    temperatura_vehiculo NUMERIC(4,2)
);

CREATE TABLE Asignacion_transporte (
    id_asignacion UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    id_vehiculo UUID NOT NULL REFERENCES Vehiculo(id_vehiculo),
    id_conductor UUID NOT NULL REFERENCES Conductor(id_conductor),
    id_carga UUID NOT NULL REFERENCES Carga(id_carga),
    id_ruta UUID NOT NULL REFERENCES Ruta(id_ruta),
    fecha_registro TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE RecepcionOrdenes (
    id_orden UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    codigo_orden VARCHAR(20) NOT NULL UNIQUE,
    tipo_orden VARCHAR(10) CHECK (tipo_orden IN ('AVICOLA', 'CONSUMO', 'MIXTA')),
    fecha_creacion TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    prioridad SMALLINT CHECK (prioridad BETWEEN 1 AND 5),
    cliente_id UUID NOT NULL REFERENCES Cliente(id)
);

CREATE TABLE GestionReclamos (
    id_reclamo UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    codigo_reclamo VARCHAR(20) NOT NULL UNIQUE,
    tipo_reclamo VARCHAR(30) NOT NULL,
    fecha_creacion TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    severidad SMALLINT CHECK (severidad BETWEEN 1 AND 3)
);


CREATE TABLE EventoEntrega (
    id_entrega UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    id_orden UUID NOT NULL REFERENCES RecepcionOrdenes(id_orden),
    id_conductor UUID NOT NULL REFERENCES Conductor(id_conductor),
    fecha_entrega TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    estado_entrega VARCHAR(20) NOT NULL CHECK (estado_entrega IN (
        'completada', 
        'fallida', 
        'con_reclamo',
        'reprogramada'
    )),
    firma_cliente VARCHAR(255),
    evidencia VARCHAR(255),
    observaciones VARCHAR(200)
    
);

```
